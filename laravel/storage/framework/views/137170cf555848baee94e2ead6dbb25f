<?php $__env->startSection('content'); ?>
<?php
$currency = Config::get('params.currency');
$required = "'required'";
?>

<div id="fh5co-contact" class="__web-inspector-hide-shortcut__ ">
    <div class="container">
        <div class="row">
            <div class="container-fluid ">
                <div class="checkout-back">
                    <?php echo Form::open(array( 'class' => 'form','url' => 'postOrder', 'name' => 'checkout')); ?>

                    <div class="checkout__main col-sm-8">
                        <?php if(count($errors->checkout) > 0): ?>
                        <div class="alert alert-danger">
                            <strong>Whoops!</strong> There were some problems with your input.<br><br>
                            <ul>
                                <?php foreach($errors->checkout->all() as $error): ?>
                                <li><?php echo e($error); ?></li>
                                <?php endforeach; ?>
                            </ul>
                        </div>
                        <?php endif; ?>
                        <div id="billing_information" class="billing_information">
                            <div class="hed"><h2>Billing <span>Information</span></h2></div>
                            <div class="form-group col-sm-6">
                                <?php echo Form::label('First Name'); ?>

                                <?php echo Form::text('billingFirstName', $user->firstName , array('class' => 'form-control',$required) ); ?>

                            </div>
                            <div class="form-group col-sm-6">
                                <?php echo Form::label('Last Name'); ?>

                                <?php echo Form::text('billingLastName', $user->lastName , array('class' => 'form-control',$required) ); ?>

                            </div>
                            <div class="form-group col-sm-6">
                                <?php echo Form::label('email'); ?>

                                <?php echo Form::text('billingEmail',  $user->email , array('class' => 'form-control',$required) ); ?>

                            </div>
                            <div class="form-group col-sm-6">
                                <?php echo Form::label('country', 'Country *'); ?>

                                <select name="billingCountry" id="billingCountry" class="form-control">
                                    <option >Country *</option>
                                    <?php foreach($countries as $country): ?>
                                    <option value="<?php echo e($country->id); ?>"
                                            <?php if($country->id== $address->country): ?> selected <?php endif; ?> > <?php echo e($country->name); ?></option>
                                    <?php endforeach; ?>
                                </select>
                            </div>
                            <div class="form-group col-sm-6">
                                <?php echo Form::label('state'); ?>

                                <select <?php echo $required ?> class="form-control" name="billingState" id="billingState">
                                    <option value="">State / Region</option>
                                    <?php foreach($states as $state): ?>
                                    <option value="<?php echo e($state->id); ?>"
                                            <?php if($state->id == $address->state): ?> selected <?php endif; ?>> <?php echo e($state->name); ?></option>
                                    <?php endforeach; ?>
                                </select>
                            </div>
                            <div class="form-group col-sm-6">
                                <?php echo Form::label('city'); ?>

                                <?php echo Form::text('billingCity', $address->city , array('class' => 'form-control',$required) ); ?>

                            </div>
                            <div class="form-group col-sm-12">
                                <?php echo Form::label('address line 1'); ?>

                                <?php echo Form::text('billingAddress1', $address->address , array('class' => 'form-control',$required) ); ?>

                            </div>
                            <div class="form-group col-sm-12">
                                <?php echo Form::label('address line 2'); ?>

                                <?php echo Form::text('billingAddress2', null , array('class' => 'form-control','') ); ?>

                            </div>
                            <div class="form-group col-sm-6">
                                <?php echo Form::label('Zip'); ?>

                                <?php echo Form::text('billingZip', $address->zip , array('class' => 'form-control',$required) ); ?>

                            </div>
                            <div class="form-group col-sm-6">
                                <?php echo Form::label('phone'); ?>

                                <?php echo Form::text('billingPhone', $address->phone , array('class' => 'form-control',$required) ); ?>

                            </div>
                            <div class="form-group col-sm-12 brackets--no">
                                <?php echo Form::checkbox('isShippingDifferent',1,false,['id'=>'is_shipping_different']);; ?>

                                Shipping address is different from billing. 
                            </div>
                        </div>
                        <div id="shipping_information" class="billing_information" style="display: none;">
                            <div class="hed"><h2>Shipping <span>Information</span></h2></div>
                            <div class="form-group col-sm-6">
                                <?php echo Form::label('firstName'); ?>

                                <?php echo Form::text('shippingFirstName', $user->firstName , array('class' => 'form-control',$required) ); ?>

                            </div>
                            <div class="form-group col-sm-6">
                                <?php echo Form::label('lastName'); ?>

                                <?php echo Form::text('shippingLastName', $user->lastName , array('class' => 'form-control','') ); ?>

                            </div>
                            <div class="form-group col-sm-6">
                                <?php echo Form::label('country', 'Country *'); ?>

                                <select name="shippingCountry" id="shippingCountry" class="form-control">
                                    <option >Country *</option>
                                    <?php foreach($countries as $country): ?>
                                    <option value="<?php echo e($country->id); ?>"
                                            <?php if($country->id== $address->country): ?> selected <?php endif; ?> > <?php echo e($country->name); ?></option>
                                    <?php endforeach; ?>
                                </select>
                            </div>
                            <div class="form-group col-sm-6">
                                <?php echo Form::label('state'); ?>

                                <select <?php echo $required ?> class="form-control" name="shippingState" id="shippingState">
                                    <option value="">State / Region</option>
                                    <?php foreach($states as $state): ?>
                                    <option value="<?php echo e($state->id); ?>"
                                            <?php if($state->id == $address->state): ?> selected <?php endif; ?>> <?php echo e($state->name); ?></option>
                                    <?php endforeach; ?>
                                </select>
                            </div>
                            <div class="form-group col-sm-6">
                                <?php echo Form::label('city'); ?>

                                <?php echo Form::text('shippingCity', $address->city , array('class' => 'form-control','') ); ?>

                            </div>
                            <div class="form-group col-sm-6">
                                <?php echo Form::label('address line 1'); ?>

                                <?php echo Form::text('shippingAddress1', $address->address , array('class' => 'form-control','') ); ?>

                            </div>
                            <div class="form-group col-sm-6">
                                <?php echo Form::label('address line 2'); ?>

                                <?php echo Form::text('shippingAddress2', null , array('class' => 'form-control','') ); ?>

                            </div>
                            <div class="form-group col-sm-6">
                                <?php echo Form::label('zip'); ?>

                                <?php echo Form::text('shippingZip', $address->phone , array('class' => 'form-control',$required) ); ?>

                            </div>
                            <div class="form-group col-sm-6">
                                <?php echo Form::label('phone'); ?>

                                <?php echo Form::text('shippingPhone', $address->phone , array('class' => 'form-control',$required) ); ?>

                            </div>
                        </div>

                        <div class="clearfix"></div>
                        <div id="shipping_method" class="billing_information col-sm-12 ">
                            <h3>Select your shipping:</h3>
                            <div class="form-group col-sm-12 p0 clrlist listview">    
                                <ul>
                                    <?php foreach($shippings as $shipping): ?>
                                    <li>
                                        <?php echo Form::radio('shipping_id', $shipping->id, true, ['class' => '', 'id' => 'selectyourshipping_'.$shipping->id ]); ?> 
                                        <label for="selectyourshipping_<?php echo $shipping->id; ?>">
                                            <?php echo $shipping->name; ?> + <?php echo e($currency[Config::get('params.currency_default')]['symbol']); ?> <?php echo $shipping->price; ?> 
                                        </label></li>
                                    <?php endforeach; ?>
                                </ul>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div id="payment_method" class="billing_information">
                            <div class="hed"><h2>Payment <span>Information</span></h2></div>
                            <?php echo $__env->make('front/common/cc_form', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
                            <div class="payment_method clrlist text-center">
                                <ul>
                                    <li>
                                        Managed by: 
                                    </li>
                                    <li>
                                        <span class='paypalicon'><img src="<?php echo e(asset('front/images/paypal-logo.png')); ?>"></span>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div id="payment_information" class="billing_information">
                            <div class="form-group col-sm-8">
                                <?php echo Form::label('Additional Message'); ?>

                                <?php echo Form::textarea('message', null, ['size' => '105x3','class' => 'form-control',$required]); ?> 
                            <span><p><strong>Note:</strong> This form submission could take <b>20 seconds</b> or longer, so keep patience!</p></span>
                            </div>
                            <div class="form-group col-sm-12 brackets--no"><button type="submit" class="btn btn-primary">Order Now</button></div>
                        </div>  
                    </div>  

                    <div class="checkout__sidebar col-sm-4">
                        <div class="order-cont clrlist listview overload">
                            <div class="hed"><h3>Order <span>Summary</span></h3></div>
                            <ul>
                                <?php /**/ $sum = 0 /**/ ?>
                                <?php foreach($cart as $product): ?>
                                <?php /**/ $sum = $sum+($product->total_price*$product->quantity)  /**/ ?>
                                <li class="order-total-descrp"><span class="txt1"><?php echo e($product->product_name); ?></span> <span class="txt2"><?php echo e($currency[Config::get('params.currency_default')]['symbol']); ?> <?php echo e($product->total_price); ?></span></li>
                                <?php endforeach; ?>
                            </ul>
                        </div>
                        <?php echo Form::hidden('grandTotal',$sum); ?>

                        <?php echo Form::close(); ?>  


                        <?php echo $__env->make('front/orders/right', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>

                    </div>       


                </div>

            </div>
        </div>

    </div>
</div>
<script>
    $('form').submit(function () {
        $(this).find('button[type=submit]').prop('disabled', true);
    });
</script>
<script>
    // A $( document ).ready() block.
    $(document).ready(function () {
        var countryId = '<?php echo $address->country; ?>';
        var stateId = '<?php echo $address->state; ?>';
        getStates(countryId);

        $("#is_shipping_different").on("change", function () {
            if ($("#is_shipping_different").is(':checked')) {
                getStates(countryId);
                $("#shipping_information").show();
            } else
            {
                $("#shipping_information").hide();
            }

        });
        //getCities(stateId);
    });

    $('#billingCountry, #shippingCountry').on('change', function () {
        var id = this.value;
        getStates(id);
    });
    $('#billingState, #shippingState').on('change', function () {
        var id = this.value;
        getCities(id);
    });
    function getStates(countryId) {
        var stateId = '<?php echo $address->state; ?>';
        $.ajax({
            type: "GET",
            url: "<?php echo url('/state/get/'); ?>/" + countryId,
            data: "",
            async: true
        }).success(function (val) {
            var response = JSON.parse(val);
            if (response.length > 0) {
                var html = "<option value=''>Select your state</option>";
                for (key in response) {
                    if (stateId == response[key].id) {
                        html += "<option value='" + response[key].id + "' selected>" + response[key].name + "</option>";
                    } else {
                        html += "<option value='" + response[key].id + "'>" + response[key].name + "</option>";
                    }

                }
            } else {
                html += "<option value=''>Select country first</option> ";
            }
            if ($("#is_shipping_different").is(':checked')) {
                $('#shippingState').html(html);
            }
            $('#billingState').html(html);
        });
    }
//    function getCities(stateId) {
//        var cityId = '<?php echo $address->city; ?>';
//        $.ajax({
//            type: "GET",
//            url: "<?php echo url('/city/get/'); ?>/" + stateId,
//            data: "",
//            async: true
//        }).success(function (val) {
//            var response = JSON.parse(val);
//            if (response.length > 0) {
//                var html1 = "<option value=''>Select your city</option>";
//                for (key in response) { 
//                    if (cityId == response[key].id) {
//                        html1 += "<option value='" + response[key].id + "' selected>" + response[key].name + "</option>";
//                    } else {
//                        html1 += "<option value='" + response[key].id + "'>" + response[key].name + "</option>";
//                    }
//
//                }
//            } else {
//                html1 += "<option value=''>Select state first</option> ";
//            }
//            $('#city').html(html1);
//        });
//
//    }

</script>  
<?php $__env->stopSection(); ?>

<?php echo $__env->make('layout', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>