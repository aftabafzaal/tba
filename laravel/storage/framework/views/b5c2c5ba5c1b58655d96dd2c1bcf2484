<?php $__env->startSection('content'); ?>
<?php
$currency = Config::get('params.currency');
$orderPrefix = Config::get('params.order_prefix');
?>
<?php echo $__env->make('admin/commons/errors', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
<div id="warning_message"></div>
<div class="row">
    <div class="col-lg-12 col-md-12">

        <div class="box box-primary">

            <div class="box-body">
                <div class="box-header with-border">
                    <h2 class="box-title">Order Information</h2>
                </div>
                <div class="col-lg-6 col-md-6 col-md-6">
                    <ul class="products-list product-list-in-box" >
                        <li><strong>Order ID:</strong> <?php echo $orderPrefix; ?><?php echo e($orders->id); ?></li>
                        <li><strong>Email:</strong> <?php echo e($orders->email); ?></li>
                        <li><strong>Order Date:</strong> <?php echo e(date("d M Y",strtotime($orders->orderDate))); ?></li>
                        <li><strong>Order Total:</strong> <?php echo e($currency[Config::get('params.currency_default')]['symbol']); ?><?php echo e($orders->grandTotal); ?></li>
                        <li><strong>Order Status:</strong></li>
                    </ul>

                    <div class="form-group">
                        <button class="btn btn-default pull-right" onclick="updateStatus('<?php echo $orders->id; ?>', $('#order_status').val())" >Update Status</button>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6 col-md-6">
                    <!--                    <div class="box-header with-border">
                                            <h2 class="box-title">User Information</h2>
                                        </div>-->
                    <ul class="products-list product-list-in-box" >
                        <li>
                            <strong>Name:</strong> <?php echo e($orders->name); ?>

                        </li>
                        <li>
                            <strong> Country:</strong> <?php echo e($addresses->country); ?>

                        </li>
                        <li>
                            <strong>State:</strong> <?php echo e($addresses->state); ?>

                        </li>
                        <li>
                            <strong>City:</strong> <?php echo e($addresses->city); ?>

                        </li>
                        <li>
                            <strong>Zip:</strong> <?php echo e($addresses->zip); ?>

                        </li>
                        <li>
                            <strong>Phone:</strong> <?php echo e($addresses->phone); ?>

                        </li>
                    </ul>
                </div>

            </div>
            <div class="box-footer">
                <a class="btn btn-default" href="<?php echo e(url('admin/orders')); ?>">Back</a>
            </div>
        </div>

    </div>
    <!--    <div class="col-lg-12 col-md-12">
            <div class="box box-primary">
                <div class="box-header with-border">
                    <h3 class="box-title">Order Status</h3>
                </div>
                <div class="box-body">
                    
                </div>
    
            </div>
        </div>-->
    <?php if(isset($orders->message) && $orders->message != ''): ?>
    <div class="col-lg-12 col-md-12">
        <div class="box box-primary">
            <div class="box-header with-border">
                <h3 class="box-title">Message</h3>
            </div>
            <div class="box-body">
                <?php echo $orders->message; ?>
            </div>

        </div>
    </div>
    <?php endif; ?>

    <div class="col-lg-12 col-md-12">
        <div class="box box-primary">
            <div class="box-header with-border">
                <h3 class="box-title">Summary</h3>
                <div class="box-tools pull-right">
                    <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                    </button>
                </div>
            </div>
            <div class="box-body">


                <table class="table table-bordered">
                    <thead>
                        <tr>                                 
                            <th>Design</th>
                            <th>Price</th>
                            <th>View</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php
                        $sum = 0;
                        $i = 0;
                        //d($orders->products,1);
                        ?>
                        <?php foreach($orders->products as $product): ?>
                        <?php
                        $rowTotal = $product->price * $product->quantity;
                        $sum += $rowTotal;

                        if ($i == 0) {
                            //$billingName=$product->billingFirstName.' '.$product->billingLastName;
                            //$shippingName=$product->shippingFirstName.' '.$product->shippingLastName;
                        }
                        ?>
                        <tr>
                            <td>


                                <img class="img-circle pull-left" style="height: 60px;" src="<?php echo e(asset('uploads/orders/'.$orders->id.'/thumbnail')); ?>/<?php echo $product->image ?>" alt="<?php echo $product->name; ?>" />



                                <div class="cart_productname">
                                    <?php echo $product->name; ?>
                                </div>
                            </td>
                            <td><span><?php echo e($currency[Config::get('params.currency_default')]['symbol']); ?> <?php echo $product->price ?></span></td>
                            <td><a href="<?php echo e(asset('uploads/orders/'.$orders->id)); ?>/<?php echo $product->image ?>" target="_blank">Download</a></td>

                        </tr>
                        <?php endforeach; ?>


                    </tbody>
                </table>
            </div></div>
    </div>



</div>
<script>
    function updateStatus(order, status)
    {
        $("#warning_message").html('');
        $('.loader').css('display', 'block');
        $("#warning_message").html('');

        var CSRF_TOKEN = "<?php echo e(csrf_token()); ?>";
        $.ajax({
            url: '<?php echo e(url("admin/updateOrderStatus")); ?>',
            type: 'POST',
            data: {_token: CSRF_TOKEN, orderid: order, status: status},
            dataType: 'JSON',
            success: function (data) {
                $('.loader').css('display', 'none');
                if (data.success === 1)
                {
                    $("#warning_message").html('<div class="alert alert-success alert-dismissible">' +
                            '<button type="button" class="close fa fa-times " data-dismiss="alert" aria-hidden="true"></button>' +
                            '<h4><i class="icon fa fa-check"></i> Alert!</h4>' +
                            'Successfully updated.' +
                            '</div>');

                } else
                {
                    $("#warning_message").html('<div class="alert alert-danger alert-dismissible">' +
                            '<button type="button" class="close   fa fa-times " data-dismiss="alert" aria-hidden="true"></button>' +
                            '<h4><i class="icon fa fa-warning"></i> Alert!</h4>' +
                            'Some thing went wrong.' +
                            '</div>');
                }
            }
        });

    }
</script>
<?php $__env->stopSection(); ?>

<?php echo $__env->make('admin/admin_template', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>